% hse-unified.sty — Unified styling system for HSE AMI Cheatsheets
% Project: HSE AMI Cheatsheets
% Author: werserk
% Version: 2.0
%
% This file provides a unified styling system that combines:
% - Base cheatsheet styling (hse-cheatsheets.sty)
% - Exam variant styling (hse-exam.sty)
% - Formalized style guide (style.sty)
% - All mathematical notation standards
% - Content structure macros
% - Quality control features

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{hse-unified}[2025/01/27 v2.0 HSE unified styling system]

% =============================================================================
% CORE PACKAGES
% =============================================================================

% Mathematical packages
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{mathtools}

% Graphics and colors
\RequirePackage{graphicx}
\RequirePackage{xcolor}

% Tables and lists
\RequirePackage{booktabs}
\RequirePackage{array}
\RequirePackage{enumitem}
\RequirePackage{tabularx}

% Layout and formatting
\RequirePackage{multicol}
\RequirePackage{titlesec}
\RequirePackage{parskip}

% Hyperlinks and references
\RequirePackage{hyperref}

% Advanced command definitions
\RequirePackage{xparse}

% =============================================================================
% COLOR SYSTEM
% =============================================================================

% Default accent color (can be overridden by calling \HSESetAccent{<HTML>})
\definecolor{accent}{HTML}{FF7517}

% Expose a simple API to set accent color and link colors
\NewDocumentCommand{\HSESetAccent}{m}{%
  \definecolor{accent}{HTML}{#1}%
  \hypersetup{colorlinks=true, linkcolor=accent, urlcolor=accent, citecolor=accent}%
}

% Initialize link colors using default accent
\hypersetup{colorlinks=true, linkcolor=accent, urlcolor=accent, citecolor=accent}

% =============================================================================
% MATHEMATICAL NOTATION STANDARDS
% =============================================================================

% Standard mathematical sets
\newcommand{\reals}{\mathbb{R}}           % Real numbers
\newcommand{\naturals}{\mathbb{N}}        % Natural numbers
\newcommand{\complex}{\mathbb{C}}         % Complex numbers
\newcommand{\integers}{\mathbb{Z}}        % Integers
\newcommand{\rationals}{\mathbb{Q}}       % Rational numbers

% Math operators commonly used
\@ifundefined{grad}{\DeclareMathOperator{\grad}{grad}}{}
\@ifundefined{divergence}{\DeclareMathOperator{\divergence}{div}}{}
\@ifundefined{curl}{\DeclareMathOperator{\curl}{curl}}{}
\@ifundefined{laplacian}{\DeclareMathOperator{\laplacian}{\Delta}}{}
\DeclareMathOperator{\trace}{tr}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\nullity}{nullity}

% Linear algebra operators
\newcommand{\linop}{\mathcal{L}}          % Linear operator
\newcommand{\algebra}{\mathcal{A}}        % Algebra
\newcommand{\sigmafield}{\mathcal{F}}     % Sigma-field
\newcommand{\expectation}{\mathbb{E}}     % Expectation
\newcommand{\variance}{\mathbb{V}}        % Variance

% =============================================================================
% VARIABLE NAMING CONVENTIONS
% =============================================================================

% Time indices: ONLY t or T (NO n allowed)
\NewDocumentCommand{\timeIndex}{m}{#1}

% Discrete step: k (only in local reasoning with annotation)
\NewDocumentCommand{\discreteStep}{m}{#1}

% Dimensions: m, d, N (use only when necessary)
\NewDocumentCommand{\dimension}{m}{#1}

% =============================================================================
% CONTENT STRUCTURE MACROS
% =============================================================================

% Generic titled box centered with adjustable width
\NewDocumentCommand{\HSEBox}{O{0.92\textwidth} m m}{%
  \begin{center}
    \fbox{\parbox{#1}{\textbf{#2}\par #3}}
  \end{center}%
}

% Specialized content blocks
\NewDocumentCommand{\HSETldr}{m}{\HSEBox{TL;DR}{#1}}
\NewDocumentCommand{\HSEExample}{m}{\HSEBox{Пример}{#1}}
\NewDocumentCommand{\HSEAlgorithm}{m}{\HSEBox{Алгоритм}{#1}}
\NewDocumentCommand{\HSEDefinition}{m}{\HSEBox{Определение}{#1}}
\NewDocumentCommand{\HSENote}{m}{\HSEBox{Замечание}{#1}}

% Problem structure components
\NewDocumentCommand{\ProblemCondition}{m}{%
  \textbf{Условие:} #1
}

\NewDocumentCommand{\ProblemHint}{m}{%
  \textbf{Подсказка:} #1
}

\NewDocumentCommand{\ProblemSolution}{m}{%
  \textbf{Решение:} #1
}

\NewDocumentCommand{\ProblemAnswer}{m}{%
  \textbf{Ответ:} #1
}

\NewDocumentCommand{\ProblemRemark}{m}{%
  \textbf{Замечание:} #1
}

% Steps environment with Russian labels
\NewDocumentEnvironment{ProblemSteps}{ O{} }{%
  \begin{enumerate}[label=\textbf{Шаг~\arabic*:}, #1]
}{\end{enumerate}}

% Steps list with Russian labels: Шаг 1., Шаг 2., ...
\NewDocumentEnvironment{HSESteps}{ O{} }{%
  \begin{enumerate}[label=\textbf{Шаг~\arabic*:}, #1]
}{\end{enumerate}}

% Inline term highlighter for first-use definitions
\NewDocumentCommand{\Term}{m}{\textbf{#1}}

% =============================================================================
% TERMINOLOGY AND LANGUAGE STANDARDS
% =============================================================================

% Standard Russian mathematical terms
\newcommand{\proof}{\textbf{Доказательство:}}
\newcommand{\example}{\textbf{Пример:}}
\newcommand{\exercise}{\textbf{Упражнение:}}
\newcommand{\remark}{\textbf{Замечание:}}
\newcommand{\definition}{\textbf{Определение:}}
\newcommand{\theorem}{\textbf{Теорема:}}
\newcommand{\lemma}{\textbf{Лемма:}}
\newcommand{\corollary}{\textbf{Следствие:}}

% Formal language helpers
\newcommand{\required}{\textbf{требуется}}
\newcommand{\mustbe}{\textbf{должно быть}}
\newcommand{\necessary}{\textbf{необходимо}}
\newcommand{\sufficient}{\textbf{достаточно}}

% =============================================================================
% LABELING CONVENTIONS
% =============================================================================

% Standard label prefixes
\newcommand{\seclabel}[1]{\label{sec:#1}}
\newcommand{\eqlabel}[1]{\label{eq:#1}}
\newcommand{\figlabel}[1]{\label{fig:#1}}
\newcommand{\thmlabel}[1]{\label{thm:#1}}
\newcommand{\exlabel}[1]{\label{ex:#1}}
\newcommand{\tablabel}[1]{\label{tab:#1}}
\newcommand{\alglabel}[1]{\label{alg:#1}}

% Reference commands with proper prefixes
\newcommand{\secref}[1]{\ref{sec:#1}}
\@ifundefined{eqref}{\newcommand{\eqref}[1]{\ref{eq:#1}}}{}
\newcommand{\figref}[1]{\ref{fig:#1}}
\newcommand{\thmref}[1]{\ref{thm:#1}}
\newcommand{\exref}[1]{\ref{ex:#1}}
\newcommand{\tabref}[1]{\ref{tab:#1}}
\newcommand{\algref}[1]{\ref{alg:#1}}

% =============================================================================
% CODE FORMATTING STANDARDS
% =============================================================================

% Code block with language specification
\NewDocumentCommand{\CodeBlock}{m m}{%
  \begin{verbatim}
\# RUN: #2
#1
  \end{verbatim}
}

% Inline code
\newcommand{\code}[1]{\texttt{#1}}

% =============================================================================
% TABLE FORMATTING STANDARDS
% =============================================================================

% Standard table environment with booktabs
\NewDocumentEnvironment{StandardTable}{O{h!} m m m}{%
  \begin{table}[#1]
  \centering
  \caption{#2}
  \label{tab:#3}
  \begin{tabular}{#4}
  \toprule
}{%
  \bottomrule
  \end{tabular}
  \end{table}
}

% =============================================================================
% NOTATION DECLARATION ENVIRONMENT
% =============================================================================

% Environment for declaring new mathematical symbols
\NewDocumentEnvironment{NotationSection}{}{%
  \subsection*{Обозначения}
  \begin{itemize}[leftmargin=*,noitemsep,topsep=0pt]
}{%
  \end{itemize}
}

% Helper for notation entries
\NewDocumentCommand{\NotationEntry}{m m}{%
  \item $#1$ — #2
}

% =============================================================================
% TITLE AND LAYOUT HELPERS
% =============================================================================

% Title helpers
\NewDocumentCommand{\HSETitle}{m m}{%
  \begin{center}
    {\Huge\bfseries #1}\\[0.5cm]
    {\large #2}\\[0.3cm]
    \vspace{0.3cm}
    \rule{\textwidth}{1pt}
  \end{center}%
}

% Contributors helpers
\providecommand{\contributors}{}
\NewDocumentCommand{\HSEContributorsDisplay}{}{%
  \if\relax\detokenize{\contributors}\relax
    ---
  \else
    \texttt{\contributors}
  \fi
}

% Footer helper: left brand link, right contributors
\NewDocumentCommand{\HSEFooter}{}{
  {\noindent \href{https://werserk.com}{\textcolor{accent}{\textbf{by werserk}}} \hfill contributors: \HSEContributorsDisplay}
}

% Two-columns helpers
\NewDocumentCommand{\HSETwoColsBegin}{}{%
  \begin{multicols}{2}
}
\NewDocumentCommand{\HSETwoColsEnd}{}{%
  \end{multicols}
}

% =============================================================================
% EXAM-SPECIFIC MACROS
% =============================================================================

% Metadata with sensible defaults
\newcommand{\ExamSubject}{Дифференциальные уравнения}
\newcommand{\ExamLecturer}{Букин К.А.}

\NewDocumentCommand{\SetExamSubject}{m}{\renewcommand{\ExamSubject}{#1}}
\NewDocumentCommand{\SetExamLecturer}{m}{\renewcommand{\ExamLecturer}{#1}}

% Centered variant title
\NewDocumentCommand{\ExamVariantTitle}{m}{%
  \begin{center}\textbf{#1}\end{center}%
}

% Problems list environment (compact enumerate)
\NewDocumentEnvironment{examproblems}{}{%
  \begin{enumerate}[leftmargin=*, label=\arabic*.]
}{%
  \end{enumerate}
}

% Problem item macro with optional points
\NewDocumentCommand{\problem}{O{} m}{%
  \item \textbf{#2}%
  \if\relax\detokenize{#1}\relax\else\hfill\textit{(#1 баллов)}\fi
}

% Points helper
\NewDocumentCommand{\points}{m}{\textit{(#1 баллов)}}

% =============================================================================
% LAYOUT DEFAULTS
% =============================================================================

% Section title defaults (non-colored; users can override in document)
\titleformat{\section}{\Large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\large\bfseries}{\thesubsection}{1em}{}
\titleformat{\subsubsection}{\normalsize\bfseries}{\thesubsubsection}{1em}{}

% List defaults for compactness
\setlist[itemize]{leftmargin=*,noitemsep,topsep=0pt}
\setlist[enumerate]{leftmargin=*,noitemsep,topsep=0pt}

% =============================================================================
% QUALITY CONTROL MACROS
% =============================================================================

% Check for forbidden variable usage
\newcommand{\checkVariables}{%
  % This would be implemented as a script
  % For now, just a reminder comment
  % TODO: Implement variable checking
}

% Validate label consistency
\newcommand{\validateLabels}{%
  % This would be implemented as a script
  % For now, just a reminder comment
  % TODO: Implement label validation
}

% =============================================================================
% STYLE COMPLIANCE INSTRUCTIONS
% =============================================================================

% Instructions for style compliance
\newcommand{\StyleInstructions}{%
  \begin{itemize}
    \item Используйте только \texttt{t} или \texttt{T} для индексов времени
    \item Объявляйте новые символы в разделе «Обозначения»
    \item Структурируйте задачи: Условие → Решение → Ответ
    \item Используйте формальную терминологию
    \item Проверяйте соответствие меток и ссылок
  \end{itemize}
}

% =============================================================================
% DOCUMENTATION
% =============================================================================

% This package provides:
% 1. Standardized variable naming (timeIndex, discreteStep, dimension)
% 2. Mathematical notation standards (reals, naturals, complex, etc.)
% 3. Content structure macros (ProblemCondition, ProblemSolution, etc.)
% 4. Labeling conventions (seclabel, eqlabel, etc.)
% 5. Code formatting standards (CodeBlock, code)
% 6. Table formatting standards (StandardTable)
% 7. Notation declaration environment (NotationSection)
% 8. Quality control reminders (checkVariables, validateLabels)
% 9. Exam-specific macros (ExamVariantTitle, examproblems, etc.)
% 10. Unified styling system for all document types

% Usage:
% \usepackage{hse-unified}
%
% In document:
% \timeIndex{t} for time indices
% \reals, \naturals, \complex for standard sets
% \ProblemCondition{...} for problem structure
% \seclabel{name} for section labels
% \CodeBlock{code}{language} for code blocks
% \HSETitle{title}{subtitle} for titles
% \HSEFooter for footers

\endinput
